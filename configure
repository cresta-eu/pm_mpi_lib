#!/bin/bash --login

if [ -z "$PS1" ] ; then
  echo -e "This script must be sourced. Use \"source ./configure [platform] [compiler] [version]\" instead."
  exit
fi

export PE_PLATFORM=$1
PE_COMPILER=$2
PE_VERSION=$3

if [ "${PE_PLATFORM}" == "" ]; then
  echo "Choosing ARCHER2 platform by default..."
  PE_PLATFORM="archer2"
fi

if [ "${PE_PLATFORM}" == "archer2" ]; then
  module -q restore
  if [ "${PE_VERSION}" == "" ]; then
    echo "Default CPE release loaded."
  else
    module load cpe/${PE_VERSION}
  fi
  if [ "${PE_COMPILER}" == "" ]; then
    echo "Cray compiler loaded by default."
  else
    module load PrgEnv-${PE_COMPILER}
  fi
  export LD_LIBRARY_PATH=${CRAY_LD_LIBRARY_PATH}:${LD_LIBRARY_PATH}
else
  echo "Error, unknown platform, ${PE_PLATFORM}!"
  return
fi
